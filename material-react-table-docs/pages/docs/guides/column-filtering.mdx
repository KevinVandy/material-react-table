import Head from 'next/head';
import RootPropTable from '../../../components/prop-tables/RootPropTable';
import ColumnOptionsTable from '../../../components/prop-tables/ColumnOptionsTable';
import StateOptionsTable from '../../../components/prop-tables/StateOptionsTable';
import DisableExample from '../../../examples/disable-column-filters';
import CustomizeFilterVariantsExample from '../../../examples/customize-filter-variants';
import CustomizeFilterModesExample from '../../../examples/customize-filter-modes';
import CustomizeFilterComponentsExample from '../../../examples/customize-filter-components';
import RemoteExample from '../../../examples/remote';

<Head>
  <title>Column Filtering Feature Guide - Material React Table Docs</title>
  <meta
    name="description"
    content="How to use, customize, or disable filter features, client-side or server side, in Material React Table"
  />
</Head>

## Column Filtering Feature Guide

Filtering is one of the most powerful features of Material React Table and is enabled by default. There is a lot of flexibility and customization available here, whether you want to customize the powerful client-side filtering already built in, or implement your own [server-side filtering](#manual-server-side-filtering), Material React Table has got you covered.

### Relevant Props

<RootPropTable
  onlyProps={
    new Set([
      'columnFilterModeOptions',
      'enableColumnFilterModes',
      'enableColumnFilters',
      'enableFilters',
      'filterFromLeafRows',
      'getFilteredRowModel',
      'manualFiltering',
      'muiTableHeadCellFilterTextFieldProps',
      'onColumnFiltersChange',
      'onFilterFnsChange',
      'onShowFiltersChange',
      'filterFns',
      'renderColumnFilterModeMenuItems',
    ])
  }
/>

### Relevant Column Options

<ColumnOptionsTable
  onlyProps={
    new Set([
      'Filter',
      'columnFilterModeOptions',
      'enableColumnFilter',
      'enableColumnFilterModes',
      'filterFn',
      'filterSelectOptions',
      'filterVariant',
      'muiTableHeadCellFilterTextFieldProps',
      'renderColumnFilterModeMenuItems',
    ])
  }
/>

### Relevant State Options

<StateOptionsTable
  onlyProps={new Set(['columnFilters', 'columnFilterFns', 'showColumnFilters'])}
/>

### Disable Filtering Features

Various subsets of filtering features can be disabled. If you want to disable filtering completely, you can set the `enableColumnFilters` prop to `false`, to remove all filters from each column. Alternatively, `enableColumnFilter` can be set to `false` for individual columns.

`enableFilters` can be set to `false` to disable both column filters and the global search filter.

<DisableExample />

### Filter Variants

Material React Table has some built in filter variants for advanced filtering. These can be specified on a per-column basis using the `filterVariant` option. The following variants are available:

- `'text'` - shows the default text field
- `'select'` - shows a select dropdown with the options specified in `filterSelectOptions`
- `'multi-select'` - shows a select dropdown with the options specified in `filterSelectOptions` and allows multiple selections with checkboxes
- `'range` - shows min and max text fields for filtering a range of values

<CustomizeFilterVariantsExample />

### Custom Filter Functions

You can specify either a pre-built filterFn that comes with Material React Table, or pass in your own custom filter functions.

#### Custom Filter Functions Per Column

By default, Material React Table uses a `fuzzy` filtering algorithm based on the popular `match-sorter` [library from Kent C. Dodds](https://www.npmjs.com/package/match-sorter). However, Material React Table also comes with numerous other filter functions that you can specify per column in the `filterFn` column options.

> Prebuilt filter functions in Material React table include `between`, `betweenInclusive`, `contains`, `empty`, `endsWith`, `equals`, `fuzzy`, `greaterThan`, `greaterThanOrEqualTo`, `lessThan`, `lessThanOrEqualTo`, `notEmpty`, `notEquals`, and `startsWith`. View these algorithms [here](https://github.com/KevinVandy/material-react-table/blob/main/src/filterFns.ts)

You can specify either a prebuilt filter function, from Material React Table or TanStack Table, or you can even specify _your own custom filter function_ in the `filterFn` column option.

```jsx
const columns = [
  {
    accessorKey: 'firstName',
    header: 'First Name',
    // using a prebuilt filter function from Material React Table
    filterFn: 'startsWith',
  },
  {
    accessorKey: 'middleName',
    header: 'Middle Name',
    // using a prebuilt filter function from TanStack Table
    filterFn: 'includesStringSensitive',
  },
  {
    accessorKey: 'lastName',
    header: 'Last Name',
    // custom filter function
    filterFn: (row, id, filterValue) =>
      row.getValue(id).startsWith(filterValue),
  },
];
```

If you provide a custom filter function, it must have the following signature:

```ts
(row: Row<TData>, id: string, filterValue: string | number) => boolean;
```

This function will be used to filter 1 row at a time, and should return a `boolean` indicating whether or not that row passes the filter.

#### Add Custom Filter Functions

You can add custom filter functions to the `filterFns` prop. These will be available to all columns to use. The `filterFn` prop on a column will override any filter function with the same name in the `filterFns` prop.

```jsx
const columns = [
  {
    accessorKey: 'name',
    header: 'Name',
    filterFn: 'customFilterFn',
  },
];

return (
  <MaterialReactTable
    data={data}
    columns={columns}
    filterFns={{
      customFilterFn: (row, id, filterValue) => {
        return row.customField === value;
      },
    }}
  />
);
```

### Filter Modes

#### Enable Column Filter Modes (Filter Switching)

If you want to let the user switch between multiple different filter modes from a dropdown menu on the Filter Textfield, you can enable that with the `enableColumnFilterModes` prop or column option. This will enable the filter icon in the filter text field to open a dropdown menu with the available filter modes when clicked.

```tsx
<MaterialReactTable columns={columns} data={data} enableColumnFilterModes />
```

#### Customize Filter Modes

You can narrow down the available filter mode options by setting the `columnFilterModeOptions` prop, or a column specific `columnFilterModeOptions` option.

```tsx
const columns = [
  {
    accessorKey: 'firstName',
    header: 'First Name',
    columnFilterModeOptions: ['fuzzy', 'contains', 'startsWith'],
  },
  {
    accessorKey: 'age',
    header: 'Age',
    columnFilterModeOptions: ['between', 'lessThan', 'greaterThan'],
  },
  }
]
```

#### Render Custom Filter Mode Menu

You can also render custom menu items in the filter mode dropdown menu by setting the `renderColumnFilterModeMenuItems` prop or column option. This option is a function that takes in the column and returns an array of `MenuItem` components. This is useful if you want to add custom filter modes that are not included in Material React Table, or if you just want to render the menu in your own custom way

```tsx
const columns = [
  {
    accessorKey: 'firstName',
    header: 'First Name',
    renderColumnFilterModeMenuItems: ({ column, onSelectFilterMode }) => [
      <MenuItem
        key="startsWith"
        onClick={() => onSelectFilterMode('startsWith')}
      >
        Start With
      </MenuItem>,
      <MenuItem
        key="endsWith"
        onClick={() => onSelectFilterMode('yourCustomFilterFn')}
      >
        Your Custom Filter Fn
      </MenuItem>,
    ],
  },
];

return (
  <MaterialReactTable
    columns={columns}
    data={data}
    enableColumnFilterModes
    // renderColumnFilterModeMenuItems could go here if you want to apply to all columns
  />
);
```

<CustomizeFilterModesExample />

### Manual Server-Side Filtering

A very common use case when you have a lot of data is to filter the data on the server, instead of client-side. In this case you will want to set the `manualFiltering` prop to `true` and manage the `columnFilters` state yourself like so.

```tsx
// You can manage and have control over the columnFilters state yourself
const [columnFilters, setColumnFilters] = useState([]);
const [data, setData] = useState([]); //data will get updated after re-fetching

useEffect(() => {
  const fetchData = async () => {
    // send api requests when columnFilters state changes
    const filteredData = await fetch();
    setData([...filteredData]);
  };
}, [columnFilters]);

return (
  <MaterialReactTable
    columns={columns}
    data={data} // this will already be filtered on the server
    manualFiltering //turn off client-side filtering
    onColumnFiltersChange={setColumnFilters} //hoist internal columnFilters state to your state
    state={{ columnFilters }} //pass in your own managed columnFilters state
  />
);
```

> Specifying `manualFiltering` turns off all client-side filtering, and assumes that the `data` you pass to `<MaterialReactTable />` is already filtered.

Here is the full Remote Data example showing off server-side **filtering**, pagination, and sorting.

<RemoteExample />

### Customize MUI Filter components

You can customize the MUI filter components by setting the `muiTableHeadCellFilterTextFieldProps` prop or column option.

You can also turn a filter textfield into a select dropdown by setting the `filterSelectOptions` prop or column option.

<CustomizeFilterComponentsExample />

### Custom Filter Components

If you need custom filter components that are much more complex than textboxes and dropdowns, you can create and pass in your own filter components using the `Filter` column option.

View Extra Storybook **[Examples](https://www.material-react-table.dev/?path=/story/features-filtering-examples)**
